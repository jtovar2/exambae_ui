var exambae=angular.module("exambae",["ngMaterial","ngAnimate","ngMessages","ngAria","ui.router"]);!function(e){e.config(["$stateProvider","$urlRouterProvider",function(e,o){o.otherwise("/"),e.state("viewexam",{url:"/exam/:examId",templateUrl:"partials/viewexam-partial.html",controller:"viewexamController",controllerAs:"vm"}).state("examreceipt",{url:"/exam/:examId/secret/:secret",templateUrl:"partials/examreceipt-partial.html",controller:"examreceiptController",controllerAs:"vm"}).state("newexam",{url:"/newexam",templateUrl:"partials/newexam-partial.html",controller:"newexamController",controllerAs:"vm"}).state("home",{url:"/",templateUrl:"partials/home-partial.html",controller:"HomeController",controllerAs:"vm"})}])}(exambae),function(e){e.factory("ExamFactory",["$q","$http",function(e,o){function t(o){return console.log(o),e.resolve(o.data)}function a(o){return console.log(o),console.log("There was an error"),e.reject(o)}function l(e){return d+"/blob/"+e}function n(e,l){var n=new FormData;return n.append("file",e),o.post(l,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(t,a)}function r(e){var l=d+"/blob/"+e;return o.delete(l).then(t,a)}function s(){var e=d+"/generate_blobstore_url";return o.get(e).then(t,a)}function c(e){var l="/exam/"+e;return o.get(d+l).then(t,a)}function i(e,l){var n="/exam/"+e+"/secret/"+l;return o.get(d+n).then(t,a)}function m(e){return o.post(d+"/exam",e).then(t,a)}var u={getExam:c,getExamWithSecret:i,postExam:m,getUploadUrl:s,deleteBlob:r,createBlob:n,getBlobDownloadUrl:l},d="http://demolisherapp.appspot.com";return u}])}(exambae),function(e){e.factory("SearchFactory",["$q","$http",function(e,o){function t(o){return console.log(o),e.resolve(o.data)}function a(o){return console.log(o),console.log("There was an error"),e.reject(o)}function l(){return o.get(c+"/frontend/get_schools").then(t,a)}function n(e){var l="/frontend/school/"+e.display+"/get_classes";return o.get(c+l).then(t,a)}function r(e,l){var n="/frontend/school/"+e.display+"/school_class/"+l.display+"/get_resources";return o.get(c+n).then(t,a)}var s={getSchools:l,getClasses:n,getExams:r},c="http://demolisherapp.appspot.com";return s}])}(exambae),function(e){e.controller("examreceiptController",["$scope","$stateParams","ExamFactory",function(e,o,t){function a(e){l.exam=e,console.log(e),l.loading=!1}var l=this;l.loading=!0,l.exam={},"secret"in o&&"examId"in o&&t.getExamWithSecret(o.examId,o.secret).then(a)}])}(exambae),function(e){e.controller("HeaderController",["$scope","$state","$rootScope",function(e,o,t){var a=this;a.state="home",t.$on("$stateChangeSuccess",function(e,t,l,n,r){a.state=o.current.name})}])}(exambae),function(e){e.controller("HomeController",["$scope","SearchFactory",function(e,o){function t(e){h.loadingSchools=!1,console.log(e),console.log(h.loadingSchools),h.schools=e}function a(e){h.loadingClasses=!0,h.loadingExams=!0,h.schoolHasBeenSelected=!1,h.schoolClasses=[]}function l(e){null==h.selectedSchool||""===h.selectedSchool?(h.schoolHasBeenSelected=!1,h.classHasBeenSelected=!1,h.selectedClass="",h.loadingClasses=!0,h.loadingExams=!0,h.schoolClasses=[]):(h.schoolHasBeenSelected=!0,o.getClasses(h.selectedSchool).then(r)),console.log("selection method"),console.log(h)}function n(e){return console.log(h.schools),e||""==e?h.schools.filter(d(e)):h.schools}function r(e){h.loadingClasses=!1,console.log(e),h.schoolClasses=e}function s(e){console.log(h.schoolClasses),h.classHasBeenSelected=!1,h.loadingExams=!0}function c(e){null===h.selectedClass||""===h.selectedClass?(h.classHasBeenSelected=!1,h.loadingExams=!0):(h.classHasBeenSelected=!0,o.getExams(h.selectedSchool,h.selectedClass).then(i))}function i(e){return h.loadingExams=!1,console.log(h.loadingExams),console.log(e),h.exams=e,e}function m(e){console.log(e);var o=e||""==e?h.schoolClasses.filter(d(e)):h.schoolClasses;return console.log("results"),console.log(o),o}function u(e){alert("Sorry! You'll need to create a Constitution for "+e+" first!")}function d(e){var o=angular.lowercase(e);return function(e){return 0===e.value.indexOf(o)}}var h=this;h.loadingExams=!0,h.exams=[{description:"test1"}],h.loadingSchools=!0,h.isSchoolSearchDisabled=!1,h.isSchoolCacheDisabled=!1,h.schoolHasBeenSelected=!1,h.schools=[],o.getSchools().then(t),h.searchSchool="",h.selectedSchool="",h.selectedSchoolChange=l,h.searchSchoolChange=a,h.schoolQuerySearch=n,h.loadingClasses=!0,h.isClassSearchDisabled=!1,h.isClassCacheDisabled=!0,h.classHasBeenSelected=!1,h.searchClass="",h.classQuerySearch=m,h.schoolClasses=[],h.selectedClass="",h.selectedClassChange=c,h.searchClassChange=s,h.newState=u}])}(exambae),function(e){e.controller("newexamController",["$scope","ExamFactory","$state",function(e,o,t){function a(){var e=document.getElementById("file").files[0];o.createBlob(e,i.uploadUrl).then(l)}function l(e){i.exam.file=e.blob_key,i.fileUploaded=!0}function n(e){i.uploadUrlLoading=!1,i.uploadUrl=e}function r(){o.deleteBlob(i.exam.file),i.fileUploaded=!1}function s(){o.postExam(i.exam).then(c)}function c(e){"secret"in e&&"id"in e?t.go("examreceipt",{examId:e.id,secret:e.secret}):(console.log("WTFFF"),console.log(e))}var i=this;i.NO_FILE_UPLOADED="NO_FILES",i.FILE_UPLOADED="FILE",i.uploadButtonState=i.NO_FILE_UPLOADED,i.fileUploaded=!1,i.uploadUrlLoading=!0,i.uploadUrl=o.getUploadUrl().then(n),i.fileUploaded=!1,i.uploadFile=a,i.deleteFile=r,i.metaDataForm={},i.exam={},i.exam.school="",i.exam.school_class="",i.exam.professor="",i.exam.file="",i.exam.description="",i.exam.free_or_nah=!0,i.exam.price=0,i.exam.number_of_downloads=0,i.exam.tags=[],i.postExam=s}])}(exambae),function(e){e.controller("viewexamController",["$scope","$stateParams","ExamFactory",function(e,o,t){function a(e){l.exam=e,console.log(e),l.loading=!1,l.downloadLink=t.getBlobDownloadUrl(l.exam.file)}console.log(o);var l=this;l.loading=!0,l.exam={},"examId"in o&&t.getExam(o.examId).then(a)}])}(exambae),function(e){e.directive("errorDirective",[function(){return{scope:{},controller:function(e,o,t,a){var l=Math.floor(2*Math.random()),n=Math.floor(7*Math.random());e.random=n,e.randomText=l},templateUrl:"partials/error-view-partial.html",link:function(e,o,t,a){}}}])}(exambae),function(e){e.directive("examDirective",[function(){return{scope:{exam:"="},controller:function(e,o,t,a){e.uploadFile=function(){console.log("uploading");e.blob}},templateUrl:"partials/exam-directive.html",replace:!0,link:function(e,o,t,a){}}}])}(exambae),function(e){e.directive("loadingDirective",[function(){return{scope:{},controller:function(e,o,t,a){var l=Math.floor(2*Math.random()),n=Math.floor(8*Math.random());e.random=n,e.randomText=l},templateUrl:"partials/loading-view-partial.html",link:function(e,o,t,a){}}}])}(exambae),function(e){e.directive("successDirective",[function(){return{scope:{},controller:function(e,o,t,a){var l=Math.floor(2*Math.random()),n=Math.floor(7*Math.random());e.random=n,e.randomText=l},templateUrl:"partials/success-view-partial.html",link:function(e,o,t,a){}}}])}(exambae);