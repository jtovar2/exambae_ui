var exambae = angular.module('exambae', ['ngMaterial', 'ngAnimate', 'ngMessages', 'ngAria', 'ui.router']);

(function(app) {
    app.config(['$stateProvider', '$urlRouterProvider', function($stateProvider, $urlRouterProvider) {

        $urlRouterProvider.otherwise('/');

        $stateProvider.state('checktransactions', {
		url: '/checktransactions',
		templateUrl: 'partials/checktransactions-partial.html',
		controller: 'checktransactionsController',
		controllerAs: 'vm'
	})

	.state('viewexam', {
		url: '/exam/:examId',
		templateUrl: 'partials/viewexam-partial.html',
		controller: 'viewexamController',
		controllerAs: 'vm'
	})

	.state('examreceipt', {
		url: '/exam/:examId/secret/:secret',
		templateUrl: 'partials/examreceipt-partial.html',
		controller: 'examreceiptController',
		controllerAs: 'vm'
	})

	.state('newexam', {
		url: '/newexam',
		templateUrl: 'partials/newexam-partial.html',
		controller: 'newexamController',
        controllerAs: 'vm'
	})

	.state('home', {
            url: '/',
            templateUrl: 'partials/home-partial.html',
            controller: 'HomeController',
            controllerAs: "vm"
        });
    }]);
})(exambae);

( function(app) { app.constant( 'LCP' , 'QA');
app.constant( 'HOSTNAME' , 'https://demolisherapp.appspot.com');
 } ) (exambae);
(function(app) {
	app.factory('bitcoinApiFactory', ['$q', '$http', 'HOSTNAME', function($q, $http, HOSTNAME) {


		var services = {
			convertUSD2BTC : convertUSD2BTC,
            getTransactions : getTransactions,
            getDogecoinExchangeRate: getDogecoinExchangeRate,
            getAddress : getAddress,
              getQRCode : getQRCode
		}

        var base_address = HOSTNAME;

		function success(data) {

            console.log(data);

            return $q.resolve(data.data);
        }

        function error(error) {
            console.log(error);
            console.log("There was an error");


            return $q.reject(error);
        }

        function getTransactions(client_wallet)
        {
            var get_transactions_path = '/transactions/' + client_wallet;

            return $http.get(base_address + get_transactions_path).then(success, error);
        }

        function getDogecoinExchangeRate()
        {
            var exchange_rate_api = 'https://api.coinmarketcap.com/v1/ticker/dogecoin/';

            return $http.get(exchange_rate_api).then(success, error);
        }
        function convertUSD2BTC(amount)
        {
        	var url = "https://blockchain.info/tobtc?currency=USD&value=" + amount;

        	return $http.get(url).then(success, error);
        }

        function getAddress(exam_id)
        {
            var url = HOSTNAME + "/create_wallet/" + exam_id;
            return $http.get(url).then(success, error);
        }

        function getQRCode(address, amount)
        {
            var url = "https://chart.googleapis.com/chart?chs=225x225&chld=L|2&cht=qr&chl=dogecoin:" + address + "&amount=" + amount;
            return $http.get(url).then(success, error);
        }
		return services;
	}]);
})(exambae);

(function(app) {
	app.factory('ExamFactory', ['$q', '$http', 'HOSTNAME', function($q, $http, HOSTNAME) {

		var services = {
			getExam: getExam,
            getExamWithSecret: getExamWithSecret,
			postExam: postExam,

            getUploadUrl: getUploadUrl,
            deleteBlob: deleteBlob,
            createBlob: createBlob,
            getBlobDownloadUrl: getBlobDownloadUrl,


            payForExam: payForExam



		}
		var base_address = HOSTNAME;


		function success(data) {

            console.log(data);

            return $q.resolve(data.data);
        }

        function error(error) {
            console.log(error);
            console.log("There was an error");


            return $q.reject(error);
        }


        function getBlobDownloadUrl(blobKey)
        {
            return base_address + '/blob/' + blobKey;
        }
        function createBlob(file, uploadUrl)
        {

            var fd = new FormData();
            fd.append('file', file);
            return $http.post(uploadUrl, fd, {
                transformRequest: angular.identity,
                headers: {'Content-Type': undefined}
            }).then(success, error);
        }

        function deleteBlob(blob_key)
        {
            var path_to_blob_api = base_address + "/blob/" + blob_key;
            return $http.delete(path_to_blob_api)
            .then(success, error);
        }

        function getUploadUrl()
        {
            var path_to_get_upload_url = base_address + '/generate_blobstore_url';
            return $http.get(path_to_get_upload_url).then(success, error);
        }

        function getExam(exam_id)
        {

            var get_exam_path = '/exam/' + exam_id;
  
            return $http.get(base_address + get_exam_path).then(success, error);
        }

        function getExamWithSecret(exam_id, secret)
        {

            var get_exam_path = '/exam/' + exam_id + '/secret/' + secret;
  
            return $http.get(base_address + get_exam_path).then(success, error);
        }

        function postExam(exam)
        {
            var post_exam_path = '/exam';

            

        
              return $http.post(base_address + post_exam_path, exam).then(success, error);
        }

        function payForExam(payment)
        {
            var pay_for_exam_path = '/pay_for_exam';

            return $http.post(base_address + pay_for_exam_path, payment).then(success, error);
        }

		return services;
	}]);
})(exambae);

(function(app) {
	app.factory('SearchFactory', ['$q', '$http', 'HOSTNAME', function($q, $http, HOSTNAME) {


		var services = {
                // Get Calls
                getSchools: getSchools,
                getClasses: getClasses,
                getExams: getExams,
                getExamsByTag: getExamsByTag,
                getTags: getTags
            };

        var base_address = HOSTNAME;


        function success(data) {

            console.log(data);

            return $q.resolve(data.data);
        }

        function error(error) {
            console.log(error);
            console.log("There was an error");


            return $q.reject(error);
        }

        function getExamsByTag(tag)
        {
            var get_exams_by_tag_path = "/frontend/tag/" + tag.display + "/get_resources";


            return $http.get(base_address + get_exams_by_tag_path).then(success, error);
        }

        function getTags () {
            var get_tags_path = '/frontend/get_tags'

            return $http.get(base_address + get_tags_path).then(success, error);
        }

        function getSchools()
        {

            var get_schools_path = '/frontend/get_schools';

            

        	var schools = ['Georgia State University', 'University of Georgia', 'Clayton State University', 'Georgia Southern']
        	/*return schools.map( function (school) {
				        return {
				          value: school.toLowerCase(),
				          display: school
				        };
    			})*/
            return $http.get(base_address + get_schools_path).then(success, error);
        }

        function getClasses(school)
        {

            var get_classes_path = '/frontend/school/' + school.display + '/get_classes'
            return $http.get(base_address + get_classes_path).then(success, error);


        }

        function getExams(school, classname)
        {
            var get_exams_path =  '/frontend/school/' + school.display + '/school_class/' + classname.display + '/get_resources';

            return $http.get(base_address + get_exams_path).then(success, error);

        }


		return services;
	}]);
})(exambae);

(function(app) {
	app.controller('checktransactionsController', ['$scope', 'bitcoinApiFactory', function($scope, bitcoinApiFactory) {


		var vm = this;
		vm.form = {};

		vm.clients_bitcoin_address = "";


		vm.transactions = [{"amount" : "0.00471444",
"blob_key" : "AMIfv95iMCCl38yRVONQoo7tHyCoThKr5r4Hjqog8wOthJAHfdaOGxng4ysEmU2q_HaYvR5mv0z4NpUvgVfAkJT7GI4AnfEI6XcjGTBupPo-ArEgFYyDeu-zGYNTWFLobXBIgBmbMljSPbMABpY4H8FEQSc5gfhIAa0Qqygr2uI9gdNwDYtiocIek8PsSUYM6pP2Dm9R7zNn-fF5emGa4_7l63FZOZb1l6TKTgF5LUzMWHo0p2aqGWFKlYRT3SrGKcSfP5P3Tn2quWFcB46mRnyO1zbFYtMjbBJLXQx4YBkhnTm-cs4yKzTn9YsAvx0pYyiMMwypCDpthooIgeYb7ZCRCukQoIImAQKId9o4lpgaVohxPHZXleqIw6vwBejVv9l9DC0fYcML",
"clients_bitcoin_address" : "asdfasdfasdfasdf",
"exam_bitcoin_address" : "213EED262E1574D2",
"state" : "NOT CONFIRMED"}
,
{"amount" : "0.00471444",
"blob_key" : "AMIfv95iMCCl38yRVONQoo7tHyCoThKr5r4Hjqog8wOthJAHfdaOGxng4ysEmU2q_HaYvR5mv0z4NpUvgVfAkJT7GI4AnfEI6XcjGTBupPo-ArEgFYyDeu-zGYNTWFLobXBIgBmbMljSPbMABpY4H8FEQSc5gfhIAa0Qqygr2uI9gdNwDYtiocIek8PsSUYM6pP2Dm9R7zNn-fF5emGa4_7l63FZOZb1l6TKTgF5LUzMWHo0p2aqGWFKlYRT3SrGKcSfP5P3Tn2quWFcB46mRnyO1zbFYtMjbBJLXQx4YBkhnTm-cs4yKzTn9YsAvx0pYyiMMwypCDpthooIgeYb7ZCRCukQoIImAQKId9o4lpgaVohxPHZXleqIw6vwBejVv9l9DC0fYcML",
"clients_bitcoin_address" : "asdfasdfasdfasdf",
"exam_bitcoin_address" : "213EED262E1574D2",
"state" : "CONFIRMED"}];

		vm.submitBitcoinAddress = submitBitcoinAddress;

		function submitBitcoinAddress()
		 {
		 	console.log("AYYYEEE");
		 	bitcoinApiFactory.getTransactions(vm.clients_bitcoin_address).then(updateTransactions);
		 }

		function updateTransactions(data)
		{
			console.log(data);
			vm.transactions = data;
		}

	}]);
})(exambae);

(function(app) {
	app.controller('examreceiptController', ['$scope', '$stateParams', 'ExamFactory', function($scope, $stateParams, ExamFactory) {

		var vm = this;
		vm.loading = true;

		vm.exam = {};


		if('secret' in $stateParams && 'examId' in $stateParams)
		{
			ExamFactory.getExamWithSecret($stateParams.examId, $stateParams.secret).then(updateExam);
		}

		function updateExam(data)
		{
			vm.exam = data;
			console.log(data);
			vm.loading = false;
		}
	}]);
})(exambae);

(function(app) {
	app.controller('HeaderController', ['$scope', '$state', '$rootScope', "$mdDialog", function($scope, $state, $rootScope, $mdDialog) {

		var vm = this;
		
		vm.state = "home";



		vm.toggleSidenav = toggleSidenav;

		vm.openMenu = openMenu;


		function openMenu($mdOpenMenu, ev) {
			$mdOpenMenu(ev);
    	};


		function toggleSidenav() 
		{
			console.log("ayyyeee");
		}

		/* Ok soo on changeSuccess is called when the switch to a state was done. So current will give you the previous one
			Lol just dont change bruh*/
		$rootScope.$on('$stateChangeSuccess', 
			function(event, toState, toParams, fromState, fromParams){
			    vm.state = $state.current.name;
		});
	}]);
})(exambae);

(function(app) {
	app.controller('HomeController', ['$scope', 'SearchFactory', 'LCP', 'HOSTNAME', function($scope, SearchFactory, LCP, HOSTNAME) {

    console.log(HOSTNAME);
    console.log(LCP);
		 var vm = this;

     vm.loadingExams = true;
     vm.exams = [ {"description" : 'test1'} ];


	vm.loadingSchools = true;
	vm.isSchoolSearchDisabled = false;
    vm.isSchoolCacheDisabled = false;

	vm.schoolHasBeenSelected = false;
	vm.schools = [];
  SearchFactory.getSchools().then(updateLoadingSchools);
	vm.searchSchool = "";
	vm.selectedSchool = "";
	vm.selectedSchoolChange = selectedSchoolChange;
	vm.searchSchoolChange = searchSchoolChange;

	vm.schoolQuerySearch = schoolQuerySearch;


  function updateLoadingSchools(data) {
    vm.loadingSchools = false;
    console.log(data);
    console.log(vm.loadingSchools);
    vm.schools = data;
  }
    function searchSchoolChange(text) {

      vm.loadingClasses = true;
      vm.loadingExams = true;
    	vm.schoolHasBeenSelected = false;

      vm.schoolClasses = [];


    }

    function selectedSchoolChange(item) {

    	if(vm.selectedSchool == null || vm.selectedSchool === "")
    	{
    		vm.schoolHasBeenSelected = false;
        vm.classHasBeenSelected = false;
        vm.selectedClass = "";
        vm.loadingClasses = true;
        vm.loadingExams = true;

        vm.schoolClasses = [];
    	}
    	else
    	{
    		vm.schoolHasBeenSelected = true;
        SearchFactory.getClasses(vm.selectedSchool).then(updateLoadingClasses);
    	}
    	console.log("selection method");
    	console.log(vm);
    }

    function schoolQuerySearch (query) {
      console.log(vm.schools);
      var results = query || query == "" ? vm.schools.filter( createFilterFor(query) ) : vm.schools;

        return results;

    }

    vm.loadingClasses = true;
    vm.isClassSearchDisabled = false;
    vm.isClassCacheDisabled = true;
    vm.classHasBeenSelected = false;
    vm.searchClass = "";
    vm.classQuerySearch = classQuerySearch;
	vm.schoolClasses = [];
	vm.selectedClass = "";
	vm.selectedClassChange = selectedClassChange;
	vm.searchClassChange = searchClassChange;



	

    function updateLoadingClasses(data) {
    vm.loadingClasses = false;
    console.log(data);
    vm.schoolClasses = data;
    }
    function searchClassChange(text) {
      console.log(vm.schoolClasses);
    	vm.classHasBeenSelected = false;
      vm.loadingExams = true;
    }

    function selectedClassChange(item) {
      if(vm.selectedClass === null || vm.selectedClass === "")
      {
        vm.classHasBeenSelected = false
        vm.loadingExams = true;
      }
      else
      {
        vm.classHasBeenSelected = true;
        SearchFactory.getExams(vm.selectedSchool, vm.selectedClass).then(updateLoadingExams);
      }



    }

    function updateLoadingExams(data)
    {
      vm.loadingExams = false;
      console.log(vm.loadingExams);
      console.log(data);
      vm.exams = data;
      return data;
    }

    function classQuerySearch (query) {
      console.log(query);
      var results = query || query == "" ? vm.schoolClasses.filter( createFilterFor(query) ) : vm.schoolClasses;
      console.log("results");
      console.log(results);
        return results;
    }


	


  vm.loadingTags = true;
  vm.isTagSearchDisabled = false;
    vm.isTagCacheDisabled = false;

  vm.tagHasBeenSelected = false;
  vm.tags = [];
  SearchFactory.getTags().then(updateLoadingTags);
  vm.searchTag = "";
  vm.selectedTag = "";
  vm.selectedTagChange = selectedTagChange;
  vm.searchTagChange = searchTagChange;

  vm.tagQuerySearch = tagQuerySearch;


  function updateLoadingTags(data) {
    vm.loadingTags = false;
    console.log(data);
    console.log(vm.loadingTags);
    vm.tags = data;
  }
    function searchTagChange(text) {

      vm.loadingClasses = true;
      vm.loadingExams = true;
      vm.tagHasBeenSelected = false;



    }

    function selectedTagChange(item) {


      console.log(item);
      if(item != null)
      {
        SearchFactory.getExamsByTag(item).then(updateLoadingExams);
      }

    }

    function tagQuerySearch (query) {
      console.log(vm.tags);
      var results = query || query == "" ? vm.tags.filter( createFilterFor(query) ) : vm.tags;

        return results;

    }



	






    vm.newState = newState;


    function newState(state) {
      alert("Sorry! You'll need to create a Constitution for " + state + " first!");
    }

    // ******************************
    // Internal methods
    // ******************************

    /**
     * Search for states... use $timeout to simulate
     * remote dataservice call.
     */
    function querySearch (query) {
    	console.log(vm.schoolClasses);
      var results = query ? vm.schoolClasses.filter( createFilterFor(query) ) : vm.schoolClasses,
          deferred;
      if (vm.simulateQuery) {
        deferred = $q.defer();
        $timeout(function () { deferred.resolve( results ); }, Math.random() * 1000, false);
        return deferred.promise;
      } else {

        return results;
      }
    }

    function searchTextChange(text) {
//      console.log(text);
    }


    /**
     * Create filter function for a query string
     */
    function createFilterFor(query) {
      var lowercaseQuery = angular.lowercase(query);

      return function filterFn(state) {
      	return (state.value.indexOf(lowercaseQuery) === 0);
      };

    }


	}]);
})(exambae);

(function(app) {
	app.controller('newexamController', ['$scope', 'ExamFactory', '$state',  'HOSTNAME',function($scope, ExamFactory, $state, HOSTNAME) {
		var vm = this;
		console.log("shubin learning today");
		vm.tagsReadonlyToggle = false;
		vm.tagsRemovable = true;


		vm.NO_FILE_UPLOADED = "NO_FILES";
		vm.FILE_UPLOADED = "FILE";
		vm.uploadButtonState = vm.NO_FILE_UPLOADED;

		vm.fileUploaded = false;

		vm.uploadUrlLoading = true;
		vm.uploadUrl = ExamFactory.getUploadUrl().then(updateUploadUrl);


		vm.fileUploaded = false;
		vm.uploadFile = uploadFile;
		vm.deleteFile = deleteFile;
		vm.metaDataForm = {};


		vm.exam = {};
		vm.exam.school = "";
		vm.exam.school_class = "";
		vm.exam.professor = "";
		vm.exam.file = "";
		vm.exam.description = "";
		vm.exam.free_or_nah = true;
		vm.exam.price = 0.00;
		vm.exam.number_of_downloads = 0;
		vm.exam.tags = [];

		vm.postExam = postExam;

		function uploadFile()
		{
			//TODO
			var file = document.getElementById('file').files[0];
			ExamFactory.createBlob(file, vm.uploadUrl).then(updateBlobKey);
		}

		function updateBlobKey(data)
		{
			vm.exam.file = data.blob_key;
			vm.fileUploaded = true;
		}

		function updateUploadUrl(data)
		{
			vm.uploadUrlLoading = false;
			vm.uploadUrl = HOSTNAME + data;
			console.log(vm.uploadUrl);
		}

		function deleteFile()
		{
			ExamFactory.deleteBlob(vm.exam.file);
			vm.exam.file = "";
			vm.fileUploaded = false;
		}

		function postExam()
		{

			if(vm.exam.price > 0.0)
			{
				vm.exam.free_or_nah = false;
			}

			ExamFactory.postExam(vm.exam).then(goToExamReceipt);


		}


		function goToExamReceipt(data)
		{
			if('secret' in data && 'id' in data)
			{
				$state.go('examreceipt', {'examId' : data.id, 'secret': data.secret});
			}
			else
			{
				console.log("WTFFF");
				console.log(data);
			}
		}


	}]);
})(exambae);

(function(app) {
	app.controller('viewexamController', ['$scope', '$stateParams', 'ExamFactory', 'bitcoinApiFactory', '$mdDialog', function($scope, $stateParams, ExamFactory, bitcoinApiFactory, $mdDialog) {

		console.log($stateParams);

		var vm = this;
		vm.loading = true;

		vm.form = {};


		vm.payForExam = payForExam;
		
		vm.exam = {};

		vm.payment = {};
		vm.payment.amount = 0;
		vm.payment.exam_bitcoin_address = "";
		vm.payment.clients_bitcoin_address = "";
		vm.payment.blob_key = "";


		vm.dogeExchangeRate = 0;
		vm.priceInBTC = 0;

		vm.qr_code_url = "";
		vm.address = "";

		if('examId' in $stateParams)
		{
			ExamFactory.getExam($stateParams.examId).then(updateExam);
		}


		function updateExam(data)
		{
			vm.exam = data;
			console.log(data);
			vm.loading = false;

			vm.downloadLink = ExamFactory.getBlobDownloadUrl(vm.exam.file);

		bitcoinApiFactory.getDogecoinExchangeRate().then(updateExchangeRate);
		bitcoinApiFactory.getAddress(vm.exam.id).then(loadWalletImage);
            
		}

		function loadWalletImage(data)
		{
			vm.address = data;
			if(!vm.exam.free_or_nah)
			{
			vm.qr_code_url = "https://chart.googleapis.com/chart?chs=300x300&chld=L|2&cht=qr&chl=dogecoin:" + data + "&amount=" + vm.priceInBTC
			}
			else
			{
							vm.qr_code_url = "https://chart.googleapis.com/chart?chs=300x300&chld=L|2&cht=qr&chl=dogecoin:" + data + "&amount=1000" 

			}
		}

		function updateExchangeRate(data)
		{
			console.log(data);
			console.log(data[0].price_usd)
			vm.dogeExchangeRate = parseFloat(data[0].price_usd);
			if(!vm.exam.free_or_nah)
			{
			vm.priceInBTC = parseFloat(vm.exam.price) /  vm.dogeExchangeRate;
			}
		}
		function payForExam()
		{
			ExamFactory.payForExam(vm.payment).then(paymentReceived())
		}

		function paymentReceived()
		{
			console.log("payment recieved")
		}

    vm.showAdvanced = function(ev) {
    $mdDialog.show({
      controller: DialogController,
      templateUrl: 'dialog1.tmpl.html',
      parent: angular.element(document.body),
      targetEvent: ev,
      clickOutsideToClose:true,
      fullscreen: $scope.customFullscreen // Only for -xs, -sm breakpoints.
    })
    .then(function(answer) {
      $scope.status = 'You said the information was "' + answer + '".';
    }, function() {
      $scope.status = 'You cancelled the dialog.';
    });
  };
        


	}]);
})(exambae);

(function(app) {
	app.directive('errorDirective', [ function() {
		return {
			scope: {},
			controller: function($scope, $element, $attrs, $transclude) {
				var numberOfTexts = 2;
				var randomTextNumber = Math.floor(Math.random() * numberOfTexts);

				var numberOfGiphies = 7;
				var randomGiphyNumber = Math.floor(Math.random() * numberOfGiphies);
				$scope.random = randomGiphyNumber;
				$scope.randomText = randomTextNumber;
			},
			// require: 'ngModel',
			// restrict: 'A', // E = Element, A = Attribute, C = Class, M = Comment
			// template: '',
			 templateUrl: 'partials/error-view-partial.html',
			// replace: true,
			// transclude: true,
			link: function($scope, elem, attrs, controller) {}
		};
	}]);
})(exambae);

(function(app) {
	app.directive('examDirective', [ function() {
		return {
			scope: {
				exam: '='
			},
			controller: function($scope, $element, $attrs, $transclude) {

				$scope.uploadFile = function(){
				console.log("uploading");
            	var file = $scope.blob;

            }
		},
			// require: 'ngModel',
			//restrict: 'EA', // E = Element, A = Attribute, C = Class, M = Comment
			//template: '<h1>Heyyy this a directive</h1>',
			templateUrl: 'partials/exam-directive.html',
			replace: true,
			// transclude: true,
			link: function($scope, elem, attrs, controller) {
				
				
			}
		};
	}]);
})(exambae);

(function(app) {
	app.directive('loadingDirective', [function() {
		return {
			scope: {},
			controller: function($scope, $element, $attrs, $transclude) {
				var numberOfTexts = 2;
				var randomTextNumber = Math.floor(Math.random() * numberOfTexts);

				var numberOfGiphies = 8;
				var randomGiphyNumber = Math.floor(Math.random() * numberOfGiphies);
				$scope.random = randomGiphyNumber;
				$scope.randomText = randomTextNumber;
			},
			// require: 'ngModel',
			// restrict: 'A', // E = Element, A = Attribute, C = Class, M = Comment
			// template: '',
			 templateUrl: 'partials/loading-view-partial.html',
			// replace: true,
			// transclude: true,
			link: function($scope, elem, attrs, controller) {}
		};
	}]);
})(exambae);

(function(app) {
	app.directive('successDirective', [ function() {
		return {
			scope: {},
			controller: function($scope, $element, $attrs, $transclude) {
				var numberOfTexts = 2;
				var randomTextNumber = Math.floor(Math.random() * numberOfTexts);

				var numberOfGiphies = 7;
				var randomGiphyNumber = Math.floor(Math.random() * numberOfGiphies);
				$scope.random = randomGiphyNumber;
				$scope.randomText = randomTextNumber;
			},
			// require: 'ngModel',
			// restrict: 'A', // E = Element, A = Attribute, C = Class, M = Comment
			// template: '',
			 templateUrl: 'partials/success-view-partial.html',
			// replace: true,
			// transclude: true,
			link: function($scope, elem, attrs, controller) {}
		};
	}]);
})(exambae);

(function(app) {
	app.directive('transactionDirective', ['ExamFactory', function(ExamFactory) {
		return {
			scope: {
				transaction: '='
			},
			controller: function($scope, $element, $attrs, $transclude) {
				console.log($scope);
				$scope.downloadLink = ExamFactory.getBlobDownloadUrl($scope.transaction.blob_key);
			},

			templateUrl: 'partials/transaction-directive.html',
			replace: true,

			link: function($scope, elem, attrs, controller) {

			}
		};
	}]);
})(exambae);
